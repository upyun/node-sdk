/**
  * UPYUN js-sdk 3.0.0
  * (c) 2017
  * @license MIT
  */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("axios")):"function"==typeof define&&define.amd?define(["axios"],t):e.upyun=t(e.axios)}(this,function(e){"use strict";function t(e,t,r){return new Promise(function(n,u){var a=e.slice||e.mozSlice||e.webkitSlice;return a?n(a.call(e,t,r)):u(new Error("not support File type!"))})}function r(e,t,r,n){function u(e,t,r,n){return e<20?t&r|~t&n:e<40?t^r^n:e<60?t&r|t&n|r&n:t^r^n}function a(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function o(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function i(e,t){return e<<t|e>>>32-t}function s(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var r=[80],n=1732584193,s=-271733879,c=-1732584194,p=271733878,f=-1009589776,l=0;l<e.length;l+=16){for(var h=n,d=s,g=c,m=p,y=f,v=0;v<80;v++){r[v]=v<16?e[l+v]:i(r[v-3]^r[v-8]^r[v-14]^r[v-16],1);var b=o(o(i(n,5),u(v,s,c,p)),o(o(f,r[v]),a(v)));f=p,p=c,c=i(s,30),s=n,n=b}n=o(n,h),s=o(s,d),c=o(c,g),p=o(p,m),f=o(f,y)}return[n,s,c,p,f]}function c(e){for(var t=[],r=(1<<n)-1,u=0;u<e.length*n;u+=n)t[u>>5]|=(e.charCodeAt(u/8)&r)<<32-n-u%32;return t}function p(e,t){var r=c(e);r.length>16&&(r=s(r,e.length*n));for(var u=[16],a=[16],o=0;o<16;o++)u[o]=909522486^r[o],a[o]=1549556828^r[o];var i=s(u.concat(c(t)),512+t.length*n);return s(a.concat(i),672)}function f(e){for(var t="",n=0;n<4*e.length;n+=3)for(var u=(e[n>>2]>>8*(3-n%4)&255)<<16|(e[n+1>>2]>>8*(3-(n+1)%4)&255)<<8|e[n+2>>2]>>8*(3-(n+2)%4)&255,a=0;a<4;a++)8*n+6*a>32*e.length?t+=r:t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(u>>6*(3-a)&63);return t}return r||(r="="),n||(n=8),function(e,t){return f(p(e,t))}(e,t)}function n(e,t){return t={exports:{}},e(t,t.exports),t.exports}function u(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function a(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&u(e.slice(0,0))}function o(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=(new Date).toGMTString();return{Authorization:i(e,{method:t,path:r="/"+e.bucketName+r,date:u,contentMd5:n}),"X-Date":u,"User-Agent":"Js-Sdk/"+w.version}}function i(e,t){var r=[t.method,t.path];["date","policy","contentMd5"].forEach(function(e){t[e]&&r.push(t[e])});var n=b(e.password,r.join("&"));return"UPYUN "+e.operatorName+":"+n}function s(e,t){if(t.bucket=e.bucketName,void 0===t["save-key"])throw new Error("upyun - calclate body sign need save-key");void 0===t.expiration&&(t.expiration=parseInt(new Date/1e3+1800,10));var r=k.encode(JSON.stringify(t));return{policy:r,authorization:i(e,{method:"POST",path:"/"+e.bucketName,policy:r})}}function c(e,t){var r=(new Date).toGMTString(),n=t.join("\n"),u=C(n+"&"+e.bucketName+"&"+r+"&"+e.password);return{Authorization:"UpYun "+e.bucketName+":"+e.operatorName+":"+u,Date:r,"User-Agent":"Js-Sdk/"+w.version}}function p(e){return 0===e.indexOf("x-upyun-meta-")}function f(e,t,r){var n=T.getHeaderSign(e,t,r);return Promise.resolve(n)}e="default"in e?e.default:e;var l=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(u,a){try{var o=t[u](a),i=o.value}catch(e){return void r(e)}if(!o.done)return Promise.resolve(i).then(function(e){n("next",e)},function(e){n("throw",e)});e(i)}return n("next")})}},h=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},d=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),g=function(){function e(e,t){var r=[],n=!0,u=!1,a=void 0;try{for(var o,i=e[Symbol.iterator]();!(n=(o=i.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){u=!0,a=e}finally{try{!n&&i.return&&i.return()}finally{if(u)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),m=function(t,r,n){var u=this,a=e.create({baseURL:t+"/"+r.bucketName});return a.interceptors.request.use(function(){var e=l(regeneratorRuntime.mark(function e(t){var a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.method.toUpperCase(),t.url=encodeURI(t.url),o=t.url.substring(t.baseURL.length),e.next=5,n(r,a,o);case 5:return t.headers.common=e.sent,e.abrupt("return",t);case 7:case"end":return e.stop()}},e,u)}));return function(t){return e.apply(this,arguments)}}(),function(e){throw new Error("upyun - request failed: "+e.message)}),a.interceptors.response.use(function(e){return e},function(e){var t=e.response;if(void 0===t)throw e;if(404!==t.status)throw new Error("upyun - response error: "+t.data.code+" "+t.data.msg);return t}),a},y={readBlockAsync:t},v=function(){function t(e,t,n){return r.apply(this,arguments)}var r=l(regeneratorRuntime.mark(function t(r,n,u){var a,o,i,s=u.authorization,c=u.policy;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(a=new FormData).append("authorization",s),a.append("policy",c),a.append("file",n),t.next=6,e.post(r,a);case 6:return o=t.sent,i=o.status,t.abrupt("return",200===i);case 9:case"end":return t.stop()}},t,this)}));return t}(),b=r,x="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},k=n(function(e,t){!function(r){var n=t,u=e&&e.exports==n&&e,a="object"==typeof x&&x;a.global!==a&&a.window!==a||(r=a);var o=function(e){this.message=e};(o.prototype=new Error).name="InvalidCharacterError";var i=function(e){throw new o(e)},s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=/[\t\n\f\r ]/g,p={encode:function(e){e=String(e),/[^\0-\xFF]/.test(e)&&i("The string to be encoded contains characters outside of the Latin1 range.");for(var t,r=e.length%3,n="",u=-1,a=e.length-r;++u<a;)t=(e.charCodeAt(u)<<16)+(e.charCodeAt(++u)<<8)+e.charCodeAt(++u),n+=s.charAt(t>>18&63)+s.charAt(t>>12&63)+s.charAt(t>>6&63)+s.charAt(63&t);return 2==r?(t=(e.charCodeAt(u)<<8)+e.charCodeAt(++u),n+=s.charAt(t>>10)+s.charAt(t>>4&63)+s.charAt(t<<2&63)+"="):1==r&&(t=e.charCodeAt(u),n+=s.charAt(t>>2)+s.charAt(t<<4&63)+"=="),n},decode:function(e){var t=(e=String(e).replace(c,"")).length;t%4==0&&(t=(e=e.replace(/==?$/,"")).length),(t%4==1||/[^+a-zA-Z0-9/]/.test(e))&&i("Invalid character: the string to be decoded is not correctly encoded.");for(var r,n,u=0,a="",o=-1;++o<t;)n=s.indexOf(e.charAt(o)),r=u%4?64*r+n:n,u++%4&&(a+=String.fromCharCode(255&r>>(-2*u&6)));return a},version:"0.1.0"};if(n&&!n.nodeType)if(u)u.exports=p;else for(var f in p)p.hasOwnProperty(f)&&(n[f]=p[f]);else r.base64=p}(x)}),w={name:"upyun",version:"3.0.0",description:"UPYUN js sdk",main:"dist/upyun.common.js",scripts:{build:"node build/build.js",test:"npm run test:server && npm run test:client","test:client":"./node_modules/.bin/karma start tests/karma.conf.js","test:server":"./node_modules/.bin/mocha --compilers js:babel-register tests/server/*"},repository:{type:"git",url:"git@github.com:upyun/node-sdk.git"},keywords:["upyun","js","nodejs","sdk","cdn","cloud","storage"],author:"Leigh",license:"MIT",bugs:{url:"https://github.com/upyun/node-sdk/issues"},homepage:"https://github.com/upyun/node-sdk",contributors:[{name:"yejingx",email:"yejingx@gmail.com"},{name:"Leigh",email:"i@zhuli.me"},{name:"kaidiren",email:"kaidiren@gmail.com"},{name:"Gaara",email:"sabakugaara@users.noreply.github.com"}],devDependencies:{"babel-cli":"^6.24.1","babel-loader":"^7.0.0","babel-plugin-external-helpers":"^6.22.0","babel-plugin-transform-runtime":"^6.23.0","babel-preset-env":"^1.4.0","babel-register":"^6.24.1",chai:"^3.5.0",istanbul:"^0.4.3",karma:"^1.7.0","karma-chrome-launcher":"^2.1.1","karma-mocha":"^1.3.0","karma-sourcemap-loader":"^0.3.7","karma-webpack":"^2.0.3",mocha:"^3.4.1",rollup:"^0.41.6","rollup-plugin-alias":"^1.3.1","rollup-plugin-babel":"^2.7.1","rollup-plugin-commonjs":"^8.0.2","rollup-plugin-json":"^2.1.1","rollup-plugin-node-resolve":"^3.0.0",should:"^9.0.2","uglify-js":"^3.0.11",webpack:"^2.5.1"},dependencies:{axios:"^0.16.1","base-64":"^0.1.0","form-data":"^2.1.4",hmacsha1:"^1.0.0",md5:"^2.2.1","mime-types":"^2.1.15"},browser:{"./upyun/utils.js":"./upyun/browser-utils.js","./upyun/form-upload.js":"./upyun/browser-form-upload.js"},peerDependencies:{"babel-polyfill":"^6.23.0"}},A=n(function(e){!function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&r.rotl(e,8)|4278255360&r.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=r.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],r=0,n=0;r<e.length;r++,n+=8)t[n>>>5]|=e[r]<<24-n%32;return t},wordsToBytes:function(e){for(var t=[],r=0;r<32*e.length;r+=8)t.push(e[r>>>5]>>>24-r%32&255);return t},bytesToHex:function(e){for(var t=[],r=0;r<e.length;r++)t.push((e[r]>>>4).toString(16)),t.push((15&e[r]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e.substr(r,2),16));return t},bytesToBase64:function(e){for(var r=[],n=0;n<e.length;n+=3)for(var u=e[n]<<16|e[n+1]<<8|e[n+2],a=0;a<4;a++)8*n+6*a<=8*e.length?r.push(t.charAt(u>>>6*(3-a)&63)):r.push("=");return r.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var r=[],n=0,u=0;n<e.length;u=++n%4)0!=u&&r.push((t.indexOf(e.charAt(n-1))&Math.pow(2,-2*u+8)-1)<<2*u|t.indexOf(e.charAt(n))>>>6-2*u);return r}};e.exports=r}()}),S={utf8:{stringToBytes:function(e){return S.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(S.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],r=0;r<e.length;r++)t.push(255&e.charCodeAt(r));return t},bytesToString:function(e){for(var t=[],r=0;r<e.length;r++)t.push(String.fromCharCode(e[r]));return t.join("")}}},R=S,j=function(e){return null!=e&&(u(e)||a(e)||!!e._isBuffer)},C=n(function(e){!function(){var t=A,r=R.utf8,n=j,u=R.bin,a=function(e,o){e.constructor==String?e=o&&"binary"===o.encoding?u.stringToBytes(e):r.stringToBytes(e):n(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||(e=e.toString());for(var i=t.bytesToWords(e),s=8*e.length,c=1732584193,p=-271733879,f=-1732584194,l=271733878,h=0;h<i.length;h++)i[h]=16711935&(i[h]<<8|i[h]>>>24)|4278255360&(i[h]<<24|i[h]>>>8);i[s>>>5]|=128<<s%32,i[14+(s+64>>>9<<4)]=s;for(var d=a._ff,g=a._gg,m=a._hh,y=a._ii,h=0;h<i.length;h+=16){var v=c,b=p,x=f,k=l;p=y(p=y(p=y(p=y(p=m(p=m(p=m(p=m(p=g(p=g(p=g(p=g(p=d(p=d(p=d(p=d(p,f=d(f,l=d(l,c=d(c,p,f,l,i[h+0],7,-680876936),p,f,i[h+1],12,-389564586),c,p,i[h+2],17,606105819),l,c,i[h+3],22,-1044525330),f=d(f,l=d(l,c=d(c,p,f,l,i[h+4],7,-176418897),p,f,i[h+5],12,1200080426),c,p,i[h+6],17,-1473231341),l,c,i[h+7],22,-45705983),f=d(f,l=d(l,c=d(c,p,f,l,i[h+8],7,1770035416),p,f,i[h+9],12,-1958414417),c,p,i[h+10],17,-42063),l,c,i[h+11],22,-1990404162),f=d(f,l=d(l,c=d(c,p,f,l,i[h+12],7,1804603682),p,f,i[h+13],12,-40341101),c,p,i[h+14],17,-1502002290),l,c,i[h+15],22,1236535329),f=g(f,l=g(l,c=g(c,p,f,l,i[h+1],5,-165796510),p,f,i[h+6],9,-1069501632),c,p,i[h+11],14,643717713),l,c,i[h+0],20,-373897302),f=g(f,l=g(l,c=g(c,p,f,l,i[h+5],5,-701558691),p,f,i[h+10],9,38016083),c,p,i[h+15],14,-660478335),l,c,i[h+4],20,-405537848),f=g(f,l=g(l,c=g(c,p,f,l,i[h+9],5,568446438),p,f,i[h+14],9,-1019803690),c,p,i[h+3],14,-187363961),l,c,i[h+8],20,1163531501),f=g(f,l=g(l,c=g(c,p,f,l,i[h+13],5,-1444681467),p,f,i[h+2],9,-51403784),c,p,i[h+7],14,1735328473),l,c,i[h+12],20,-1926607734),f=m(f,l=m(l,c=m(c,p,f,l,i[h+5],4,-378558),p,f,i[h+8],11,-2022574463),c,p,i[h+11],16,1839030562),l,c,i[h+14],23,-35309556),f=m(f,l=m(l,c=m(c,p,f,l,i[h+1],4,-1530992060),p,f,i[h+4],11,1272893353),c,p,i[h+7],16,-155497632),l,c,i[h+10],23,-1094730640),f=m(f,l=m(l,c=m(c,p,f,l,i[h+13],4,681279174),p,f,i[h+0],11,-358537222),c,p,i[h+3],16,-722521979),l,c,i[h+6],23,76029189),f=m(f,l=m(l,c=m(c,p,f,l,i[h+9],4,-640364487),p,f,i[h+12],11,-421815835),c,p,i[h+15],16,530742520),l,c,i[h+2],23,-995338651),f=y(f,l=y(l,c=y(c,p,f,l,i[h+0],6,-198630844),p,f,i[h+7],10,1126891415),c,p,i[h+14],15,-1416354905),l,c,i[h+5],21,-57434055),f=y(f,l=y(l,c=y(c,p,f,l,i[h+12],6,1700485571),p,f,i[h+3],10,-1894986606),c,p,i[h+10],15,-1051523),l,c,i[h+1],21,-2054922799),f=y(f,l=y(l,c=y(c,p,f,l,i[h+8],6,1873313359),p,f,i[h+15],10,-30611744),c,p,i[h+6],15,-1560198380),l,c,i[h+13],21,1309151649),f=y(f,l=y(l,c=y(c,p,f,l,i[h+4],6,-145523070),p,f,i[h+11],10,-1120210379),c,p,i[h+2],15,718787259),l,c,i[h+9],21,-343485551),c=c+v>>>0,p=p+b>>>0,f=f+x>>>0,l=l+k>>>0}return t.endian([c,p,f,l])};a._ff=function(e,t,r,n,u,a,o){var i=e+(t&r|~t&n)+(u>>>0)+o;return(i<<a|i>>>32-a)+t},a._gg=function(e,t,r,n,u,a,o){var i=e+(t&n|r&~n)+(u>>>0)+o;return(i<<a|i>>>32-a)+t},a._hh=function(e,t,r,n,u,a,o){var i=e+(t^r^n)+(u>>>0)+o;return(i<<a|i>>>32-a)+t},a._ii=function(e,t,r,n,u,a,o){var i=e+(r^(t|~n))+(u>>>0)+o;return(i<<a|i>>>32-a)+t},a._blocksize=16,a._digestsize=16,e.exports=function(e,r){if(void 0===e||null===e)throw new Error("Illegal argument "+e);var n=t.wordsToBytes(a(e,r));return r&&r.asBytes?n:r&&r.asString?u.bytesToString(n):t.bytesToHex(n)}}()}),T={genSign:i,getHeaderSign:o,getPolicyAndAuthorization:s,getPurgeHeaderSign:c};return{Client:function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;h(this,t);var u="undefined"!=typeof window;if(void 0===e.bucketName)throw new Error("upyun - must config bucketName");if("function"==typeof r&&(n=r,r={}),"function"!=typeof n&&u)throw new Error("upyun - must config a callback function getHeaderSign in client side");if(!u&&(void 0===e.operatorName||void 0===e.password))throw new Error("upyun - must config operateName and password in server side");this.isBrowser=u;var a=Object.assign({domain:"v0.api.upyun.com",protocol:"https"},r);this.endpoint=a.protocol+"://"+a.domain,this.req=m(this.endpoint,e,n||f),this.bucket=e,u||this.setBodySignCallback(T.getPolicyAndAuthorization)}return d(t,[{key:"setBucket",value:function(e){this.bucket=e,this.req.defaults.baseURL=this.endpoint+"/"+this.bucketName}},{key:"setBodySignCallback",value:function(e){if("function"!=typeof e)throw new Error("upyun - getBodySign should be a function");this.bodySignCallback=e}},{key:"usage",value:function(){function e(){return t.apply(this,arguments)}var t=l(regeneratorRuntime.mark(function e(){var t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/";return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.req.get(n+"?usage");case 2:return t=e.sent,r=t.data,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"listDir",value:function(){function e(){return t.apply(this,arguments)}var t=l(regeneratorRuntime.mark(function e(){var t,r,n,u,a,o,i,s,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=p.limit,l=void 0===f?100:f,h=p.order,d=void 0===h?"asc":h,m=p.iter,y=void 0===m?"":m;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={"x-list-limit":l,"x-list-order":d},y&&(t["x-list-iter"]=y),e.next=4,this.req.get(c,{headers:t});case 4:if(r=e.sent,n=r.data,u=r.headers,404!==(a=r.status)){e.next=10;break}return e.abrupt("return",!1);case 10:if(o=u["x-upyun-list-iter"],n){e.next=13;break}return e.abrupt("return",{files:[],next:o});case 13:return i=n.split("\n"),s=i.map(function(e){var t=e.split("\t"),r=g(t,4),n=r[0],u=r[1],a=r[2],o=r[3];return{name:n,type:u,size:parseInt(a),time:parseInt(o)}}),e.abrupt("return",{files:s,next:o});case 16:case"end":return e.stop()}},e,this)}));return e}()},{key:"putFile",value:function(){function e(e,r){return t.apply(this,arguments)}var t=l(regeneratorRuntime.mark(function e(t,r){var n,u,a,o,i,s,c,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=["Content-MD5","Content-Length","Content-Type","Content-Secret","x-gmkerl-thumb"],u={},n.forEach(function(e){var t=e.toLowerCase(),r=f[e]||f[t];r?u[e]=r:p(e)&&(u[e]=f[e])}),e.next=5,this.req.put(t,r,{headers:u});case 5:if(a=e.sent,o=a.headers,200!==(i=a.status)){e.next=15;break}return s=["x-upyun-width","x-upyun-height","x-upyun-file-type","x-upyun-frames"],c={},s.forEach(function(e){var t=e.split("x-upyun-")[1];o[e]&&(c[t]=o[e],"file-type"!==t&&(c[t]=parseInt(c[t],10)))}),e.abrupt("return",!(Object.keys(c).length>0)||c);case 15:return e.abrupt("return",!1);case 16:case"end":return e.stop()}},e,this)}));return e}()},{key:"makeDir",value:function(){function e(e){return t.apply(this,arguments)}var t=l(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.req.post(t,null,{headers:{folder:"true"}});case 2:return r=e.sent,n=r.status,e.abrupt("return",200===n);case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"headFile",value:function(){function e(e){return t.apply(this,arguments)}var t=l(regeneratorRuntime.mark(function e(t){var r,n,u,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.req.head(t);case 2:if(r=e.sent,n=r.headers,404!==(u=r.status)){e.next=7;break}return e.abrupt("return",!1);case 7:return a=["x-upyun-file-type","x-upyun-file-size","x-upyun-file-date","Content-Md5"],o={},a.forEach(function(e){var t=e.split("x-upyun-file-")[1];n[e]&&(o[t]=n[e],"size"!==t&&"date"!==t||(o[t]=parseInt(o[t],10)))}),e.abrupt("return",o);case 11:case"end":return e.stop()}},e,this)}));return e}()},{key:"deleteFile",value:function(){function e(e){return t.apply(this,arguments)}var t=l(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.req.delete(t);case 2:return r=e.sent,n=r.status,e.abrupt("return",200===n);case 5:case"end":return e.stop()}},e,this)}));return e}()},{key:"deleteDir",value:function(){function e(e){return t.apply(this,arguments)}var t=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.deleteFile(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return e}()},{key:"getFile",value:function(){function e(e){return t.apply(this,arguments)}var t=l(regeneratorRuntime.mark(function e(t){var r,n,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!u||"undefined"==typeof window){e.next=2;break}throw new Error("upyun - save as stream are only available on the server side.");case 2:return e.next=4,this.req({method:"GET",url:t,responseType:u?"stream":null});case 4:if(404!==(r=e.sent).status){e.next=7;break}return e.abrupt("return",!1);case 7:if(u){e.next=9;break}return e.abrupt("return",r.data);case 9:return n=r.data.pipe(u),e.abrupt("return",new Promise(function(e,t){n.on("finish",function(){return e(n)}),n.on("error",t)}));case 11:case"end":return e.stop()}},e,this)}));return e}()},{key:"updateMetadata",value:function(){function e(e,r){return t.apply(this,arguments)}var t=l(regeneratorRuntime.mark(function e(t,r){var n,u,a,o,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"merge";return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n={};for(u in r)p(u)?n[u]=r:n["x-upyun-meta-"+u]=r[u];return e.next=4,this.req.patch(t+"?metadata="+i,null,{headers:n});case 4:return a=e.sent,o=a.status,e.abrupt("return",200===o);case 7:case"end":return e.stop()}},e,this)}));return e}()},{key:"getMetadata",value:function(){function e(e){return t.apply(this,arguments)}var t=l(regeneratorRuntime.mark(function e(t){var r,n,u,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.req.get(t);case 2:if(r=e.sent,n=r.headers,200===(u=r.status)){e.next=7;break}return e.abrupt("return",!1);case 7:a={};for(o in n)p(o)&&(a[o]=n[o]);return e.abrupt("return",a);case 10:case"end":return e.stop()}},e,this)}));return e}()},{key:"blockUpload",value:function(){function e(e,r){return t.apply(this,arguments)}var t=l(regeneratorRuntime.mark(function e(t,r){var n,u,a,o,i,s,c,p,f,l,h,d,g,m,v,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n="undefined"!=typeof window,u=void 0,a=void 0,!n){e.next=8;break}u=r.size,a=r.type,e.next=12;break;case 8:return e.next=10,y.getFileSizeAsync(r);case 10:u=e.sent,a=y.getContentType(r);case 12:return Object.assign(b,{"x-upyun-multi-stage":"initiate","x-upyun-multi-length":u,"x-upyun-multi-type":a}),e.next=15,this.req.put(t,null,{headers:b});case 15:o=e.sent,i=o.headers,s=i["x-upyun-multi-uuid"],c=i["x-upyun-next-part-id"],p=void 0;case 20:return f=1048576,l=c*f,h=Math.min(l+f,u),e.next=25,y.readBlockAsync(r,l,h);case 25:return p=e.sent,e.next=28,this.req.put(t,p,{headers:{"x-upyun-multi-stage":"upload","x-upyun-multi-uuid":s,"x-upyun-part-id":c}});case 28:d=e.sent,g=d.headers,c=g["x-upyun-next-part-id"];case 31:if("-1"!==c){e.next=20;break}case 32:return e.next=34,this.req.put(t,null,{headers:{"x-upyun-multi-stage":"complete","x-upyun-multi-uuid":s}});case 34:return m=e.sent,v=m.status,e.abrupt("return",204===v||201===v);case 37:case"end":return e.stop()}},e,this)}));return e}()},{key:"formPutFile",value:function(){function e(e,r){return t.apply(this,arguments)}var t=l(regeneratorRuntime.mark(function e(t,r){var n,u,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof this.bodySignCallback){e.next=2;break}throw new Error("upyun - must setBodySignCallback first!");case 2:return a.bucket=this.bucket.bucketName,a["save-key"]=t,e.next=6,this.bodySignCallback(this.bucket,a);case 6:return n=e.sent,e.next=9,v(this.endpoint+"/"+a.bucket,r,n);case 9:return u=e.sent,e.abrupt("return",u);case 11:case"end":return e.stop()}},e,this)}));return e}()},{key:"purge",value:function(){function t(e){return r.apply(this,arguments)}var r=l(regeneratorRuntime.mark(function t(r){var n,u,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return"string"==typeof r&&(r=[r]),t.prev=1,n=T.getPurgeHeaderSign(this.bucket,r),t.next=5,e.post("http://purge.upyun.com/purge/","purge="+r.join("\n"),{headers:n});case 5:if(u=t.sent,a=u.data,0!==Object.keys(a.invalid_domain_of_url).length){t.next=11;break}return t.abrupt("return",!0);case 11:throw new Error("some url purge failed "+a.invalid_domain_of_url.join(" "));case 12:t.next=17;break;case 14:throw t.prev=14,t.t0=t.catch(1),new Error("upyun - request failed: "+t.t0.message);case 17:case"end":return t.stop()}},t,this,[[1,14]])}));return t}()}]),t}(),sign:T,Bucket:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";h(this,e),this.bucketName=t,this.operatorName=r,this.password=C(n)}}});